/**
 * uptimerobot监控所需js
 */
window.myApp=window.myApp||{};myApp.dashboard=(function(f){var d="",c=0,s=0,o=Date.now(),k=((typeof(__refresh)=="number")?__refresh:300),i={},v={},p={},b=[],t,e="",m=false;function n(){o=Date.now();d=f("#server-template").html();i=f("#server-container").html("");p=f("#server-title").html("");v=f("#last-update");b=[];p.append('<th style="width:21%"></th>');p.append('<th style="width:9%">近30日</th>');for(var x=6;x>=0;x--){t=new Date(Date.parse(new Date().toString())-86400000*x);e=(t.getMonth()+1)+"-"+t.getDate();p.append('<th style="width:10%">'+e+"</th>")}m=false;for(var w in __apiKeys){l(__apiKeys[w],w)}s=setInterval(j,1000)}function l(w,y){var x="https://api.uptimerobot.com/getMonitors?apiKey="+w+"&customUptimeRatio=1-2-3-4-5-6-7-30&format=json&logs=1&noJsonCallback=1";f.ajax({url:x,context:document.body,dataType:"json",success:function(z){q(z.monitors.monitor[0],y)}})}function q(S,K){S.alert="";switch(parseInt(S.status,10)){case 0:S.statustxt="未知";S.statusicon="question-circle";S.label="green accent-2";break;case 1:S.statustxt="未知";S.statusicon="question-circle";S.label="green accent-2";break;case 2:S.statustxt="正常";S.statusicon="check";S.label=" green accent-3";S.alert="check-circle";break;case 8:S.statustxt="异常";S.statusicon="times";S.label="lime accent-2";S.alert="exclamation-circle";m=true;break;case 9:S.statustxt="故障";S.statusicon="exclamation-circle";S.label="red accent-4";S.alert="times-circle";m=true;break}var E=Date.parse("-1month");for(var M in S.log){var D=S.log[M],A=Date.parse(D.datetime.replace(/\/(\d\d) /,"/20$1 "));if(A<E){S.log.splice(M,M+1)}else{S.log[M].datetime=A}}S.log=f.merge([],S.log);var T,P,C,y,F,N,O=[],Q=1;N=86400000*1;T=Date.parse(new Date().toString());F=T-N;C=F;if(!S.log.length){switch(parseInt(S.status,10)){case 2:y=2;break;case 8:case 9:y=1;break;default:y=0}O.push({type:y,len:1,left:F,right:T})}else{for(var H=0;H<S.log.length;H++){C=S.log[H].datetime;if(C<F){C=F}P=S.log[H].type;switch(parseInt(P,10)){case 1:P=1;break;case 2:P=2;break;default:P=0}Q=Q-(T-C)/N;if(O.length>0&&O[O.length-1].type==P){O[O.length-1].len+=(T-C)/N;O[O.length-1].left=C}else{O.push({type:P,len:(T-C)/N,left:C,right:T})}T=C;if(C<=F){break}}if(C>F){switch(parseInt(P,10)){case 1:y=2;break;case 2:y=1;break;default:y=0}if(O.length>0&&O[O.length-1].type==P){O[O.length-1].len+=Q;O[O.length-1].left=F}else{O.push({type:y,len:Q,start:F,end:O[O.length-1].left})}}}var J,B;S.progress=[];while(J=O.pop()){B=""+g(parseInt(J.type),true);if(J.len==1){B+=" (近24小时)"}else{if(J.right-J.left<1000*3540){B+=" ("+new Number((J.right-J.left)/(1000*60)).toFixed(0)+" 分钟)"}else{B+=" ("+new Number((J.right-J.left)/(1000*3600)).toFixed(1)+" 小时)"}B+='<br><span class="ttime">'+u(J.left)+" ~ "+u(J.right)+"</span>"}S.progress.push({type:J.type,types:h,len:(J.len*100).toString(),stattip:B})}var I=S.customuptimeratio.split("-");for(var R=6;R>=1;R--){I[R]=I[R]*(R+1)-I[R-1]*(R)}var w=[],z,x;for(R=0;R<I.length;R++){x=(100-I[R])*(R==I.length-1?14.4*30:14.4);z=x/60;if(I[R]>=99.97){w[R]="可用率 100%"}else{if(I[R]<=0){w[R]="可用率 0.00%故障 "+(R==I.length-1?"720 小时":"24 小时")}else{if(x<60){w[R]="可用率 "+new Number(I[R]).toFixed(2)+"%<br>故障 "+new Number(x).toFixed(0)+" 分钟"}else{w[R]="可用率 "+new Number(I[R]).toFixed(2)+"%<br>故障 "+new Number(z).toFixed(1)+" 小时"}}}}S.charts=[{title:"1",uptimes:I[7],uptime:w[7],uptype:r,upsign:a},{title:"2",uptimes:I[6],uptime:w[6],uptype:r,upsign:a},{title:"3",uptimes:I[5],uptime:w[5],uptype:r,upsign:a},{title:"4",uptimes:I[4],uptime:w[4],uptype:r,upsign:a},{title:"5",uptimes:I[3],uptime:w[3],uptype:r,upsign:a},{title:"6",uptimes:I[2],uptime:w[2],uptype:r,upsign:a},{title:"7",uptimes:I[1],uptime:w[1],uptype:r,upsign:a},{title:"all",uptimes:I[0],uptime:w[0],uptype:r,upsign:a}];var G=f(Mustache.render(d,S));b[K]=G;for(var L=0;L<__apiKeys.length;L++){if(b[L]==undefined){break}else{if(b[L]==true){continue}else{i.append(b[L]);b[L]=true}}}c++;if(c>=__apiKeys.length){c=0;f(".fa-check-circle").tooltip({html:true});f("#stattip-load").addClass("hide");if(m){f("#stattip-err").removeClass("hide");f("#stattip-ok").addClass("hide");f(".fa-exclamation-circle").tooltip({html:false})}else{f("#stattip-ok").removeClass("hide");f("#stattip-err").addClass("hide")}}}function j(){var x=Date.now(),w=parseInt((x-o)/1000,10),z=Math.floor((k-w)/60),y=k-(z*60)-w;y=(y<10)?"0"+y:y;if(w>k){clearInterval(s);n()}else{v.html(z+":"+y)}}function h(){switch(parseInt(this.type,10)){case 1:return"danger";case 2:return"success";case 99:return"default";case 98:return"default";default:return"default"}}function g(w,x){switch(w){case 1:return(x?'<span class="fa fa-exclamation-circle"></span> ':"")+"故障";case 2:return(x?'<span class="fa fa-check-circle"></span> ':"")+"正常";default:return(x?'<span class="fa fa-times-circle"></span> ':"")+"未知"}}function u(w){t=new Date(parseInt(w));e=(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e}function r(){var w=this.uptimes;if(w>=99.9){return"success"}else{if(w>=98){return"warning"
}else{return"danger"}}}function a(){var w=this.uptimes;if(w>=99.9){return"check-circle"}else{if(w>=98){return"exclamation-circle"}else{return"times-circle"}}}return{init:n}}(jQuery));